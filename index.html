<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cierre de turno</title>
<style>
body { font-family: Arial; background:#f2f2f2; }
.container {
  max-width: 700px;
  margin: 40px auto;
  background:white;
  padding:25px;
  border-radius:8px;
}
input, select, textarea, button {
  width:100%;
  padding:10px;
  margin-top:8px;
}
button {
  background:black;
  color:white;
  font-size:16px;
  margin-top:15px;
}
#status { margin-top:15px; font-weight:bold; }
.loading { color: orange; }
.error { color:red; }
.success { color:green; }
</style>
</head>

<body>
<div class="container">
<h2>Cierre de Turno</h2>

<input id="fecha" type="date">

<select id="responsable">
  <option value="">Seleccione responsable</option>
  <option>Laura Velásquez</option>
  <option>Wendy Molina</option>
  <option>Carlos Bejarano</option>
  <option>Roberto Pérez</option>
  <option>Daniela Ahumada</option>
</select>

<h4>Turno</h4>
<input id="hora_inicio" type="time">
<input id="hora_fin" type="time">

<label>¿Se extendió tu turno?</label>
<select id="extendido" onchange="mostrarExtension()">
  <option value="No">No</option>
  <option value="Si">Sí</option>
</select>

<div id="bloque_extension" style="display:none;">
<select id="cuanto">
<option value="">Seleccione tiempo</option>
<option value="15">15 min</option><option value="30">30 min</option><option value="45">45 min</option>
<option value="60">1 hora</option><option value="75">1h15</option><option value="90">1h30</option>
<option value="120">2 horas</option><option value="180">3 horas</option>
</select>
</div>

<input id="efectivo_apertura" type="number" placeholder="Efectivo Apertura">
<input id="compras_turno" type="number" placeholder="Compras">
<input id="domicilios_turno" type="number" placeholder="Domicilios">
<input id="efectivo_sistema" type="number" placeholder="Efectivo Sistema">
<input id="efectivo_real" type="number" placeholder="Efectivo Real">
<input id="datafono_sistema" type="number" placeholder="Datafono Sistema">
<input id="datafono_real" type="number" placeholder="Datafono Real">
<input id="transferencias_sistema" type="number" placeholder="Transferencias Sistema">
<input id="transferencia_real" type="number" placeholder="Transferencia Real">
<input id="rappi_sistema" type="number" placeholder="Rappi Sistema">
<input id="rappi_real" type="number" placeholder="Rappi Real">
<input id="bolsa" type="number" placeholder="Bolsa">
<input id="caja" type="number" placeholder="Caja">
<input id="meta" type="number" placeholder="Meta">
<textarea id="comentarios" placeholder="Comentarios"></textarea>

<button onclick="enviar()">Enviar cierre</button>
<button onclick="verificar()">Verificar</button>

<div id="status"></div>
<div id="verificacion"></div>

</div>

<script>
function mostrarExtension(){
  document.getElementById("bloque_extension").style.display =
  document.getElementById("extendido").value==="Si"?"block":"none";
}

function obtenerDatos(){
  const campos = [
    "fecha","responsable","hora_inicio","hora_fin","efectivo_apertura","compras_turno","domicilios_turno",
    "efectivo_sistema","efectivo_real","datafono_sistema","datafono_real",
    "transferencias_sistema","transferencia_real","rappi_sistema","rappi_real","bolsa","caja","meta"
  ];

  for (let c of campos){
    if(document.getElementById(c).value===""){
      mostrarMensaje(`Falta el campo: ${c}`, "error");
      return null;
    }
  }

  return {
    fecha: fecha.value,
    responsable: responsable.value,
    hora_inicio: hora_inicio.value,
    hora_fin: hora_fin.value,
    extendido: extendido.value,
    minutos: extendido.value==="Si"?cuanto.value:0,
    efectivo_apertura: efectivo_apertura.value,
    compras: compras_turno.value,
    domicilios: domicilios_turno.value,
    efectivo_sistema: efectivo_sistema.value,
    efectivo_real: efectivo_real.value,
    datafono_sistema: datafono_sistema.value,
    datafono_real: datafono_real.value,
    transferencias_sistema: transferencias_sistema.value,
    transferencia_real: transferencia_real.value,
    rappi_sistema: rappi_sistema.value,
    rappi_real: rappi_real.value,
    bolsa: bolsa.value,
    caja: caja.value,
    meta: meta.value,
    comentarios: comentarios.value
  };
}

function mostrarMensaje(msg,tipo){
  const s=document.getElementById("status");
  s.className=tipo;
  s.innerText=msg;
  setTimeout(()=>{s.innerText="";},5000);
}

function limpiar(){
  document.querySelectorAll("input,textarea,select").forEach(e=>e.value="");
}

function enviar(){
  const data=obtenerDatos();
  if(!data) return;

  mostrarMensaje("Enviando...", "loading");

  fetch("https://n8n.globalnexoshop.com/webhook/abeb7f0c-228e-429f-8abd-3cf0d21a962d",{
    method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)
  }).then(()=>{
    mostrarMensaje("Cierre enviado ✔","success");
    setTimeout(limpiar,3000);
  });
}

function verificar(){
  const data=obtenerDatos();
  if(!data) return;

  document.getElementById("verificacion").innerText="Verificando…";

  fetch("https://n8n.globalnexoshop.com/webhook/verificar",{
    method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)
  })
  .then(r=>r.json())
  .then(res=>{
    document.getElementById("verificacion").innerText=JSON.stringify(res,null,2);
  });
}
</script>
</body>
</html>
